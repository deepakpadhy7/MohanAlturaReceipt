name: Build APK
on:
 push:
   branches: [ main ]
 workflow_dispatch:
jobs:
 build:
   runs-on: ubuntu-latest
   steps:
     - name: Checkout code
       uses: actions/checkout@v4
     - name: Set up JDK 17
       uses: actions/setup-java@v4
       with:
         java-version: '17'
         distribution: 'temurin'
     - name: Set up Android SDK
       uses: android-actions/setup-android@v3
     - name: Show repo structure
       run: find . -maxdepth 5 -not -path './.git/*' | sort
     - name: Build APK
       run: |
         PROJ_DIR=$(find . -name "settings.gradle" -not -path "./.git/*" | head -1 | xargs dirname)
         echo "Project dir: $PROJ_DIR"
         cd "$PROJ_DIR"
         wget -q https://services.gradle.org/distributions/gradle-8.2-bin.zip -O gradle.zip
         unzip -q gradle.zip
         ./gradle-8.2/bin/gradle wrapper --gradle-version 8.2
         chmod +x gradlew
         ./gradlew assembleDebug --stacktrace
     - name: Find and upload APK
       run: |
         APK=$(find . -name "*.apk" | head -1)
         echo "APK_PATH=$APK" >> $GITHUB_ENV
     - name: Upload APK
       uses: actions/upload-artifact@v4
       with:
         name: MohanAltura-Receipt-APK
         path: ${{ env.APK_PATH }}
